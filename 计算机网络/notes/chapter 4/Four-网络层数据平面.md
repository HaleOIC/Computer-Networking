# Four-网络层数据平面

## 4.1 网络层概述

**网络层服务**

- 在发送主机和接收主机对之间传送**段（segment）** 
- 在发送端将段封装到数据报中
- 在接收端，将段上交给传输层实体 
- 网络层协议存在于**每一个**主机和路由器
- 路由器检查每一个经过它的**IP**数据报的头部 



### 4.1.1 转发和路由选择：数据平面和控制平面

**功能**

- 转发
  - 将分组从路由器的输入接口转发到合适的输出接口 
- 路由
  - 使用路由算法来 决定分组从发送主机到目标接收主机的路径 
    - 路由选择算法 
    - 路由选择协议 

#### 数据平面

- 本地，每个路由器功能 
- 决定从路由器输入端口 到达的分组如何转发到输出端口 
- 转发功能： 
  - 传统方式：基于目标地址+转发表 
  - **SDN**方式：基于多个字段和**流表**

#### 控制平面

- 网络范围内的逻辑 
- 决定数据报如何在路由器之间路由，决定数据报从源到目标主机之间的端到端路径 
- 2个控制平面方法 
  - 传统的路由算法: 在路由器中被实现 
  - **software-defined networking  (SDN)**: 在远程的服务器中实现 

### 4.1.2 网络服务模型

这些服务可能包括：

- 可靠传送
- 延迟上界保证
- 有序分组交付
- 确保最小带宽
- 安全性

显然上述$Internet$都做不到，只能提供 **(best-effort service) 尽力而为服务**

常见的服务情况：

![](img/4-1-1.png)

## 4.2 路由器组成

![](img/4-2-1.png)

### 4.2.1 输入端口处理和基于目的地转发

![](img/4-2-2.png)

- **line termination**物理层： $Bit$级的接收
- **link layer protocol(recieve)** 数据链路层: 链路层协议动作、解封装
- **lookup、forwarding** 分布式交换：
  - 根据数据报头部的信息如：目的地址 ，在输入端口内存中的转发表中查找合适的输出端口（匹配+行动） 
  - **基于目标的转发：**仅仅依赖于IP数据 报的**目标IP**地址（传统方法） 
  - **通用转发**：基于头部字段的任意集合进行转发 



当给定目标地址查找转发表时，采用**最长**地址前缀匹配的目标地址表项 











## 4.2 路由器组成





## 4.3 IP: Internet protocol







## 4.4 通用转发和SDN 